<div class="row wrapper border-bottom white-bg page-heading">
  <div class="col-sm-12">
    <h2>Dispatch Summary Report</h2>  
      <ol class="breadcrumb">
        <li><%= link_to @operation_name, '/operations/' + @operation %></li>
        <% if @region.present? %>
          <li><%= link_to @region_name, '/dispatch_report/index?operation=' + @operation +';region=' + @region %></li>
        <% end %>
          <% if @zone.present? %>
          <li><%= link_to @zone_name, '/dispatch_report/index?operation=' + @operation +';region=' + @region +';zone=' + @zone %></li>
        <% end %>
        <% if @woreda.present? %>
          <li><%= link_to @woreda_name, '/dispatch_report/index?operation=' + @operation +';region=' + @region +';zone=' + @zone +';woreda=' + @woreda %></li>
        <% end %>
      </ol>  
  </div>
</div>

<div class="row">
  <div class="wrapper wrapper-content">
<div class="ibox float-e-margins">
  <div class="ibox-content">

    <table class="table table-striped cats-grouped-datatable" data_group_col_no='0' data_sort_col_no='0'>
    <thead>
      <tr>
      <% @dispatch_report_cols.each do |column| %>
          <th><%= column %></th>
        <% end %>
      </tr>
    </thead>

    <tbody>      
    <% @dispatch_report.each do |dispatch_summary| %>
        <tr>
          <% if params[:woreda].present? || params[:zone].present? || params[:region].present? %>
            <% if params[:woreda].present? %>
              <td><%= 'FDP: ' + dispatch_summary['location'] %></td>
            <% elsif params[:zone].present? %>
              <td><%= link_to 'Woreda: ' + dispatch_summary['location'], '/dispatch_report/index?operation=' + params[:operation] +';region=' + params[:region] +';zone=' + params[:zone] + ';woreda=' + dispatch_summary['location_id'].to_s %></td>
            <% elsif  params[:region].present? %>
              <td><%= link_to 'Zone: ' + dispatch_summary['location'], '/dispatch_report/index?operation=' + params[:operation] +';region=' + params[:region] +';zone=' + dispatch_summary['location_id'].to_s %></td>
            <% elsif  params[:operation].present? %>
              <td><%= link_to 'Region: ' + dispatch_summary['location'], '/dispatch_report/index?operation=' + params[:operation] +';region=' + dispatch_summary['location_id'].to_s %></td>
            <% end %>
              <td><%= dispatch_summary['requisition'] %></td>
              <td><%= dispatch_summary['commodity'] %></td>
              <td><%= dispatch_summary['allocated'].to_f.round(2) %></td>
              <td><%= 
                if (dispatch_summary['dispatched'].present?) 
                  dispatch_summary['dispatched'].to_f.round(2) 
                else 
                   0.00 
                end %></td>
              <td><%= 
                if (dispatch_summary['allocated'].to_f > 0.0)
              ((dispatch_summary['dispatched'].to_f / dispatch_summary['allocated'].to_f) * 100).to_f.round(2) 
                else
                  0.00
                end
              %>%
              </td>
            <% else %>   
              <td><%= link_to dispatch_summary['location'], '/dispatch_report/index?operation=' + params[:operation] +';region=' + dispatch_summary['location_id'].to_s %></td>
              <td><%= dispatch_summary['allocated'] %></td>
              <td><%= 
                if (dispatch_summary['dispatched'].present?) 
                  dispatch_summary['dispatched'].to_f.round(2) 
                else 
                   0.00 
                end %></td>
              <td><%= ((dispatch_summary['dispatched'].to_f / dispatch_summary['allocated'].to_f) * 100).to_f.round(2) %>%</td>
            <% end %>      
        </tr>
    <% end %>
    </tbody>
    </table>      
  </div>
</div> 
</div>
</div> 