<div class="row wrapper border-bottom white-bg page-heading">
  <div class="col-sm-4">
    <h2>Dispatch Report</h2>
  </div>
  <div class="col-sm-8">
    <div class="title-action">
    	<% if params[:woreda].present? %>
			<%= link_to '<h2><i class="fa fa-chevron-left" aria-hidden="true"></i> Back to Zone</h2>'.html_safe, '/dispatch_report/index?operation=' + params[:operation] +';region=' + params[:region] +';zone=' + params[:zone].to_s %>
		<% elsif params[:zone].present? %>
			<%= link_to '<h2><i class="fa fa-chevron-left" aria-hidden="true"></i> Back to Region</h2>'.html_safe, '/dispatch_report/index?operation=' + params[:operation] +';region=' + params[:region].to_s %>
		<% elsif  params[:region].present? %>
			<%= link_to '<h2><i class="fa fa-chevron-left" aria-hidden="true"></i> Back to Operation</h2>'.html_safe, '/dispatch_report/index?operation=' + params[:operation].to_s %>
		<% end %>
    </div>
  </div>
</div>

<div class="ibox float-e-margins">
  	<div class="ibox-content">
      	<%= form_tag( "/dispatch_report/index" ,{ class: 'form-inline', style: 'display: inline-block;', role: 'form', method: 'GET'}) do %>      	

	        <% if( !(params[:woreda].present? || params[:zone].present? || params[:region].present?) ) %>

		        <div class="form-group">
		          <%= label_tag :operation, "Operation", { :class => ' control-label', :required => true } %>

		          <div class="">
		            <%= select_tag  :operation,  options_from_collection_for_select( Operation.all, 'id', 'name', params[:operation] ) , { :required => true, :prompt => "-- Choose --", :class => 'form-control col-md-3 data-parsley-required' }  %>
		          </div>
		        </div>

		        <div class="form-group">
		          <label for=""></label>
		          <div>
		              <input type="submit" name="filter" value="Go" class="btn btn-sm btn-primary" />
		          </div>
		        </div>

			<% end %>       
        <% end %>
  	</div>
</div>


<div class="ibox float-e-margins">
  <div class="ibox-content">

    <table class="table table-striped cats-datatable">
		<thead>
			<tr>
			<% @dispatch_report_cols.each do |column| %>
			    <th><%= column %></th>
		   	<% end %>
			</tr>
		</thead>

		<tbody>      
		<% @dispatch_report.each do |dispatch_summary| %>
		    <tr>
		    	<% if params[:woreda].present? || params[:zone].present? || params[:region].present? %>
		    		<% if params[:woreda].present? %>
		    			<td><%= dispatch_summary['location'] %></td>
	    			<% elsif params[:zone].present? %>
	    				<td><%= link_to dispatch_summary['location'], '/dispatch_report/index?operation=' + params[:operation] +';region=' + params[:region] +';zone=' + params[:zone] + ';woreda=' + dispatch_summary['location_id'].to_s %></td>
	    			<% elsif  params[:region].present? %>
	    				<td><%= link_to dispatch_summary['location'], '/dispatch_report/index?operation=' + params[:operation] +';region=' + params[:region] +';zone=' + dispatch_summary['location_id'].to_s %></td>
	    			<% elsif  params[:operation].present? %>
	    				<td><%= link_to dispatch_summary['location'], '/dispatch_report/index?operation=' + params[:operation] +';region=' + dispatch_summary['location_id'].to_s %></td>
	    			<% end %>
			        <td><%= dispatch_summary['requisition'] %></td>
			        <td><%= dispatch_summary['commodity'] %></td>
			        <td><%= dispatch_summary['allocated'].to_f.round(2) %></td>
			        <td><%= dispatch_summary['dispatched'].to_f.round(2) %></td>
			        <td><%= ((dispatch_summary['dispatched'].to_f / dispatch_summary['allocated'].to_f) * 100).to_f.round(2) %>%</td>
		        <% else %>	 
		        	<td><%= link_to dispatch_summary['region_name'], '/dispatch_report/index?operation=' + params[:operation] +';region=' + dispatch_summary['location_id'].to_s %></td>
			        <td><%= dispatch_summary['allocated'] %></td>
			        <td><%= dispatch_summary['dispatched'] %></td>
			        <td><%= ((dispatch_summary['dispatched'].to_f / dispatch_summary['allocated'].to_f) * 100).to_f.round(2) %>%</td>
		        <% end %>      
		    </tr>
		<% end %>
		</tbody>
    </table>        
    
  </div>
</div> 